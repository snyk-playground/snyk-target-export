---
alwaysApply: true
always_on: true
trigger: always_on
applyTo: "**"
description: Snyk Security At Inception
---

# Project security best practices

- Always run snyk_code_scan tool for new first party code that is generated in a Snyk-supported language.
- If any security issues are found based on newly introduced or modified code or dependencies, attempt to fix the issues using the results context from Snyk.
- Rescan the code after fixing the issues to ensure that the issues were fixed and that there are no newly introduced issues.
- Repeat this process until no new issues are found.

## general

- always be concise, direct and don't try to appease me.
- DOUBLE CHECK THAT YOUR CHANGES ARE REALLY NEEDED. ALWAYS STICK TO THE GIVEN GOAL, NOT MORE.
- I repeat: don't optimize, don't refactor if not needed.
- Adhere to the rules, fix linting & test issues that are newly introduced, this should include fmt and vet issues.
- Maintain existing code patterns and conventions
- minimize changes to existing code

## how to implement

- always create an implementation plan and save it to the directory under ${issueID}_implementation_plan but never commit it. take it as a reference for each step and how to proceed. Get confirmation that the plan is ok. update it as needed and get it approved, before you start changing files. the `issueID` is usually specified in the current branch in the format `XXX-XXXX`.
- don't comment what is done, instead comment why something is done if the code is not clear
- always write and update test cases. iterate until they pass.
- to manipulate the environment in tests, please use t.SetEnv, never use os.SetEnv
- follow clean code
- follow golang best practices, produce idiomatic code
- please check the makefile - make lint runs the linter, other targets might be relevant as well.
- use existing mocks, don't write new ones.
- if you use mocks, use gomock to generate them.
- always run the tests after editing.
- if you add debug logging to tests, ensure log messages are not using a Nop logger.
- always use the linter as well as fmt and vet.
- don't change code that does not need to be changed. only do the minimum changes.
- this is not a library. if files are not used or needed anymore, delete them instead of deprecating them.
- if a tool call fails, analyze why it failed and correct your approach. don't prompt the user for help.
- if you don't know something, read the code instead of assuming it.
- commenting out code to fix errors is not a solution. instead, fix the error.

## security

- determine the absolute path of the project directory. you can do that e.g. by executing pwd on the shell within the directory.
- always use snyk for sca and code scanning. scan with both tools. you need to pass the absolute path of the directory we are scanning.
- run snyk code tests after each edit. pass the absolute path of the project directory as a parameter
- run snyk sca tests after updating go.mod and pass the absolute path of the project directory as a parameter.
- run snyk sca and code test before committing. if not test data, fix issues before committing.

## fixing issues

- fix security issues if they are fixable. take the snyk scan results and the test results as input
- don't fix test data

## committing

- when asked to commit, always use conventional commit messages (Conventional Commit Style (Subject + Body)). be descriptive in the body. if you find a JIRA issue (XXX-XXXX) in the branch name, use it as a postfix to the subject line in the format [XXX-XXXX]
- consider all commits in the current branch when committing, to have the context of the current changes.
- NEVER commit without explicit user approval - ALWAYS ask first
- NEVER push without explicit user approval - ALWAYS ask first
- NEVER create a PR without explicit user approval - ALWAYS ask first
- after creating a commit, STOP and ask: "Commit created. Ready to push?"
- after pushing, STOP and ask: "Pushed. Ready to create PR?"
- when asked to push, always use 'git push --set-upstream origin $(git_current_branch)' with git_current_branch being the current branch we are on
- never force push
- never commit the hashicorp gomod
- regularly fetch main branch and offer to merge it into git_current_branch
- after pushing offer to create a PR on github. analyze the changes by comparing the current branch ($(git_current_branch)) with origin/main, and craft a PR description and title.
use the github pr template in this repository